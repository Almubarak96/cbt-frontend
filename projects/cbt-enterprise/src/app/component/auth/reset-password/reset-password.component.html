<div class="auth-container">
  <div class="auth-card">
    <div class="card-body">
      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="auth-form">
        
        <!-- Header Section -->
        <div class="auth-header">
          <div class="auth-icon">
            <i class="bi bi-shield-lock"></i>
          </div>
          <h2 class="auth-title">Create New Password</h2>
          <p class="auth-subtitle">Choose a strong password to secure your account</p>
        </div>

        <!-- Token Error -->
        <div *ngIf="error && !token" class="alert alert-danger" role="alert">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          {{ error }}
          <div class="mt-2">
            <a routerLink="/auth/forgot-password" class="alert-link">Request new reset link</a>
          </div>
        </div>

        <!-- Success Message -->
        <div *ngIf="message" class="alert alert-success" role="alert">
          <i class="bi bi-check-circle-fill me-2"></i>
          {{ message }}
          <div class="mt-2">
            <small>Redirecting to login page...</small>
          </div>
        </div>

        <!-- Error Alert -->
        <div *ngIf="error && token" class="alert alert-danger" role="alert">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          {{ error }}
        </div>

        <!-- Form Fields -->
        <div class="form-group" *ngIf="token">
          <label for="password" class="form-label required">New Password</label>
          <input type="password" 
                 class="form-control" 
                 [class.is-invalid]="isFieldInvalid('password')"
                 formControlName="password" 
                 id="password"
                 placeholder="Enter your new password">
          
          <!-- Password Strength Indicator -->
          <div *ngIf="form.get('password')?.value && !isFieldInvalid('password')" 
               class="password-strength mt-2">
            <div class="strength-bar">
              <div class="strength-fill" [ngClass]="getPasswordStrengthClass()"></div>
            </div>
            <small class="strength-text" [ngClass]="getPasswordStrengthClass()">
              Strength: {{ getPasswordStrengthText() }}
            </small>
          </div>
          
          <div class="invalid-feedback" *ngIf="isFieldInvalid('password')">
            {{ getFieldError('password') }}
          </div>
          
          <!-- Password Requirements -->
          <div class="password-requirements mt-2">
            <small class="text-muted">
              <i class="bi bi-info-circle me-1"></i>
              Must be at least 8 characters long
            </small>
          </div>
        </div>

        <div class="form-group" *ngIf="token">
          <label for="confirmPassword" class="form-label required">Confirm Password</label>
          <input type="password" 
                 class="form-control" 
                 [class.is-invalid]="isFieldInvalid('confirmPassword') || hasFormError('mismatch')"
                 formControlName="confirmPassword" 
                 id="confirmPassword"
                 placeholder="Confirm your new password">
          <div class="invalid-feedback" *ngIf="isFieldInvalid('confirmPassword') || hasFormError('mismatch')">
            <div *ngIf="isFieldInvalid('confirmPassword')">
              {{ getFieldError('confirmPassword') }}
            </div>
            <div *ngIf="hasFormError('mismatch')">
              Passwords do not match
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="auth-actions" *ngIf="token">
          <button type="submit" 
                  class="btn btn-primary" 
                  [disabled]="form.invalid || loading">
            <i class="bi" [class.bi-shield-check]="!loading" [class.bi-arrow-repeat]="loading"></i>
            {{ loading ? 'Resetting...' : 'Reset Password' }}
          </button>
        </div>

        <!-- Back to Login -->
        <div class="auth-links">
          <a routerLink="/auth/login" class="auth-link">
            <i class="bi bi-arrow-left me-1"></i>
            Back to Sign In
          </a>
        </div>

        <!-- Security Note -->
        <div class="security-note mt-4 p-3 bg-light rounded">
          <small class="text-muted">
            <i class="bi bi-shield-check me-1"></i>
            <strong>Security Tip:</strong> Use a unique password that you don't use for other accounts.
          </small>
        </div>
      </form>
    </div>
  </div>
</div>